<script>
// ===== Progress Bar Timing Control =====
// 0   = Skip progress bar, show all content immediately
// 0.5 = Progress bar duration = 50% of audio duration  
// 1   = Progress bar duration = 100% of audio duration (full length)
var delayFactor = 1;

// ===== Translation Mode Control =====
// 0 = Hide Chinese translations
// 1 = Show Chinese translations  
var translationMode = 1;
</script>



<div class="box" id="card-box">
  <div class="top-fixed">
    <div class="word" id="animated-word">{{Word}}&#8203;</div>
    <div class="phonetic">{{IPA}}</div>
    <hr class="divider progress-bar" id="progress-divider">
  </div>

  <div class="middle-content delayed-content">
    <div class="example">
      <div class="static-text">{{Example}}</div>
      <details class="translation-zh">
        <summary>{{Example}}</summary>
        <div class="translation">{{ExampleZH}}</div>
      </details>
    </div>
    <div class="definition">
      <div class="static-text">{{Meaning}}</div>
      <details class="translation-zh">
        <summary>{{Meaning}}</summary>
        <div class="translation">{{MeaningZH}}</div>
      </details>
    </div>
  </div>
  <div class="image-container delayed-content">
    {{Image}}
  </div>
  <div class="sound">{{Sound}} {{Sound_Example}}</div>
</div>

<style>
.word {
  opacity: 1;
}

.phonetic {
  opacity: 1;
}

.progress-bar {
  width: 0 !important;
  transition-property: width;
  transition-timing-function: linear;
}

.progress-bar.animating {
  width: 100% !important;
}

/* 确保在所有屏幕尺寸下进度条都能正常工作 */
@media screen and (max-width: 600px) {
  .progress-bar {
    width: 0 !important;
    transition-property: width !important;
    transition-timing-function: linear !important;
  }
  
  .progress-bar.animating {
    width: 100% !important;
  }
}

.delayed-content {
  opacity: 0;
  transition: opacity 1s ease-out;
}

.delayed-content.is-visible {
  opacity: 1;
}

/* Translation display control via CSS classes */
.translation-mode-0 .translation-zh { 
  display: none !important; 
}
.translation-mode-1 .translation-zh { 
  display: block; 
}


</style>

<script>
(function() {
  var soundDurText = '{{Sound_Dur}}';
  var soundExampleDurText = '{{Sound_Example_Dur}}';
  var soundDur = parseFloat(soundDurText) || 0;
  var soundExampleDur = parseFloat(soundExampleDurText) || 0;
  var totalDelay = (soundDur + soundExampleDur) * delayFactor;
  
  // 应用翻译模式设置
  document.getElementById('card-box').classList.add('translation-mode-' + translationMode);

  var progressBar = document.getElementById('progress-divider');
  var delayedElements = document.querySelectorAll('.delayed-content');

  var animationDuration = totalDelay > 0 ? totalDelay : 3;

  if (delayFactor === 0) {
    // delayFactor = 0: 跳过进度条，立即显示所有内容
    if (progressBar) progressBar.classList.add('animating');
    delayedElements.forEach(function(el) { el.classList.add('is-visible'); });
    return;
  }

  // 启动进度条动画
  if (progressBar) {
    progressBar.style.transitionDuration = animationDuration + 's';
    
    setTimeout(function() {
      progressBar.classList.add('animating');
    }, 20);
  }

  // 音频结束时，立即显示其他内容
  var contentDelay = animationDuration * 1000;
  
  setTimeout(function() {
    delayedElements.forEach(function(el) {
      el.classList.add('is-visible');
    });
  }, contentDelay);
})();
</script>

