<script>
// ===== Delay Control Settings =====
// 0   = Disable delay, show all content immediately
// 0.5 = Delay time is set to half of the estimated duration
var delayFactor = 1;

// ===== Animation Effect Settings =====
// 0 = Disable animation effects, show word immediately
// 1 = Logarithmic optimized opacity animation
var animationMode = 1;
</script>

<!-- Non-Chinese users can ignore this setting
    翻译设置：修改 translation-mode-0 中的数字
     0 = 不显示翻译
     1 = 显示中文翻译
-->



<div class="box translation-mode-1">
  <div class="top-fixed">
    <div class="word" id="animated-word">{{Word}}&#8203;</div>
    <div class="phonetic delayed-content">{{IPA}}</div>
    <hr class="divider delayed-content">
  </div>

  <div class="middle-content delayed-content">
    <div class="example">
      <div class="static-text">{{Example}}</div>
      <details class="translation-zh">
        <summary>{{Example}}</summary>
        <div class="translation">{{ExampleZH}}</div>
      </details>
    </div>
    <div class="definition">
      <div class="static-text">{{Meaning}}</div>
      <details class="translation-zh">
        <summary>{{Meaning}}</summary>
        <div class="translation">{{MeaningZH}}</div>
      </details>
    </div>
  </div>
  <div class="image-container delayed-content">
    {{Image}}
  </div>
  <div class="sound">{{Sound}} {{Sound_Example}}</div>
</div>

<style>
.delayed-content {
  opacity: 0;
  transition: none;
}

.show-delayed-content .delayed-content {
  opacity: 1;
}

/* ===== Logarithmic Optimized Opacity Algorithm ===== */
@keyframes opacity-logarithmic-optimized {
  0% { opacity: 0.01; }
  16% { opacity: 0.08; }
  32% { opacity: 0.18; }
  48% { opacity: 0.32; }
  64% { opacity: 0.50; }
  80% { opacity: 0.72; }
  96% { opacity: 0.92; }
  100% { opacity: 1; }
}

/* ===== Additional Animation Algorithms (Reserved for Future Use) ===== */
/* Add new animation keyframes here if needed */

/* ===== Content Fade-in Animation (1 second version) ===== */
@keyframes content-fade-in {
  0% { opacity: 0.01; }
  20% { opacity: 0.15; }
  40% { opacity: 0.35; }
  60% { opacity: 0.55; }
  80% { opacity: 0.75; }
  100% { opacity: 1; }
}

/* Animation state styles */
.word.animating {
  transition: none;
}

.delayed-content.animating {
  transition: none;
}


</style>

<script>
(function() {
  var soundDurText = '{{Sound_Dur}}';
  var soundExampleDurText = '{{Sound_Example_Dur}}';
  var soundDur = parseFloat(soundDurText) || 0;
  var soundExampleDur = parseFloat(soundExampleDurText) || 0;
  var totalDelay = (soundDur + soundExampleDur) * delayFactor;
  
  var box = document.querySelector('.box');
  var word = document.getElementById('animated-word');
  var delayedElements = document.querySelectorAll('.delayed-content');
  
  // Debug information (uncomment for troubleshooting)
  // console.log('Sound durations:', soundDur, soundExampleDur, 'Total delay:', totalDelay);
  
  if (totalDelay > 0) {
    // Apply animation based on animationMode setting
    if (animationMode === 0) {
      // Mode 0: No animation, show word immediately
      // console.log('Animation disabled, showing word immediately');
      if (word) {
        word.style.opacity = '1';
      }
    } else if (animationMode === 1) {
      // Mode 1: Logarithmic optimized opacity animation
      if (word) {
        word.classList.add('animating');
        word.style.animation = 'opacity-logarithmic-optimized ' + totalDelay + 's ease-out forwards';
        // console.log('Word animation duration:', totalDelay + 's (Logarithmic Optimized Algorithm)');
      }
    }
    // Mode 2 and above: Reserved for future animation algorithms
    
    // Apply 1-second fade-in animation to other content after delay
    setTimeout(function() {
      delayedElements.forEach(function(element) {
        element.classList.add('animating');
        element.style.animation = 'content-fade-in 1s ease-out forwards';
      });
      
      // console.log('Other content starts 1-second fade-in animation');
      
      // Clean up animation states after 1 second
      setTimeout(function() {
        if (word) {
          word.classList.remove('animating');
        }
        delayedElements.forEach(function(element) {
          element.classList.remove('animating');
          element.classList.add('show-delayed-content');
        });
        
        if (box) {
          box.classList.add('show-delayed-content');
        }
        
        // console.log('All animations completed');
      }, 1000);
       
    }, totalDelay * 1000);
  } else {
    // Use fixed timing when no delay detected
    var fixedDelay = 3;
    
    if (animationMode === 0) {
      // Mode 0: No animation, show all content immediately
      // console.log('Animation disabled, showing all content immediately');
      if (word) {
        word.style.opacity = '1';
      }
      delayedElements.forEach(function(element) {
        element.classList.add('show-delayed-content');
      });
      if (box) {
        box.classList.add('show-delayed-content');
      }
    } else if (animationMode === 1) {
      // Mode 1: Fixed 3-second word animation + 1-second content animation
      // console.log('No delay detected, using fixed timing:', fixedDelay + 's word + 1s content');
      
      if (word) {
        word.classList.add('animating');
        word.style.animation = 'opacity-logarithmic-optimized ' + fixedDelay + 's ease-out forwards';
      }
       
      // Show other content after 3 seconds
      setTimeout(function() {
        delayedElements.forEach(function(element) {
          element.classList.add('animating');
          element.style.animation = 'content-fade-in 1s ease-out forwards';
        });
         
        // Clean up states after 1 second
        setTimeout(function() {
          if (word) {
            word.classList.remove('animating');
          }
          delayedElements.forEach(function(element) {
            element.classList.remove('animating');
            element.classList.add('show-delayed-content');
          });
           
          if (box) {
            box.classList.add('show-delayed-content');
          }
        }, 1000);
         
      }, fixedDelay * 1000);
    }
    // Mode 2 and above: Reserved for future animation algorithms
  }
})();
</script>

